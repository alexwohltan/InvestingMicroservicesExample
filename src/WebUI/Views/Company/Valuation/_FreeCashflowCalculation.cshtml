@model CompanyBenchmarkModel

@{
    DataStructures.FundamentalData.Filing Filing1 = Model.CompanyData.Filings.OrderByDescending(e => e.FilingDate).First();
    DataStructures.FundamentalData.Filing? Filing2 = Model.CompanyData.Filings.Count() >= 2 ? Model.CompanyData.Filings.OrderByDescending(e => e.FilingDate).ToList()[1] : null;
    DataStructures.FundamentalData.Filing? Filing3 = Model.CompanyData.Filings.Count() >= 3 ? Model.CompanyData.Filings.OrderByDescending(e => e.FilingDate).ToList()[2] : null;
    DataStructures.FundamentalData.Filing? Filing4 = Model.CompanyData.Filings.Count() >= 4 ? Model.CompanyData.Filings.OrderByDescending(e => e.FilingDate).ToList()[3] : null;
    DataStructures.FundamentalData.Filing? Filing5 = Model.CompanyData.Filings.Count() >= 5 ? Model.CompanyData.Filings.OrderByDescending(e => e.FilingDate).ToList()[4] : null;
}

<div id="freeCashflowCalculation">
    <table class="table table-small">
        <tr style="text-align:right">
            <th></th>
            @if (Filing5 != null)
            {
                <th>@Filing5.FiscalYear</th>
            }
            @if (Filing4 != null)
            {
                <th>@Filing4.FiscalYear</th>
            }
            @if (Filing3 != null)
            {
                <th>@Filing3.FiscalYear</th>
            }
            @if (Filing2 != null)
            {
                <th>@Filing2.FiscalYear</th>
            }
            <th>@Filing1.FiscalYear</th>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Revenue</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.Revenue / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.Revenue / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.Revenue / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.Revenue / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.Revenue / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Cost of Revenue</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.CostofRevenue / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.CostofRevenue / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.CostofRevenue / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.CostofRevenue / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.CostofRevenue / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Gross Profit</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.GrossProfit / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.GrossProfit / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.GrossProfit / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.GrossProfit / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.GrossProfit / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Operating Expenses</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.OperatingExpenses / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.OperatingExpenses / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.OperatingExpenses / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.OperatingExpenses / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.OperatingExpenses / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Operating Income (EBIT)</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.OperatingIncomeLoss / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.OperatingIncomeLoss / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.OperatingIncomeLoss / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.OperatingIncomeLoss / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.OperatingIncomeLoss / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Pretax Income (EBT)</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.PretaxIncomeLoss / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.PretaxIncomeLoss / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.PretaxIncomeLoss / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.PretaxIncomeLoss / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.PretaxIncomeLoss / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Income Tax</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.IncomeTaxExpenseBenefitNet / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.IncomeTaxExpenseBenefitNet / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.IncomeTaxExpenseBenefitNet / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.IncomeTaxExpenseBenefitNet / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.IncomeTaxExpenseBenefitNet / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Tax Rate</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:P1}", Filing5.IncomeStatement.TaxRate)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:P1}", Filing4.IncomeStatement.TaxRate)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:P1}", Filing3.IncomeStatement.TaxRate)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:P1}", Filing2.IncomeStatement.TaxRate)</td>
            }
            <td>@string.Format("{0:P1}", Filing1.IncomeStatement.TaxRate)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold ">
            <td style="text-align:left">Net Income</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.NetIncome / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.NetIncome / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.NetIncome / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.NetIncome / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.NetIncome / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Net Income (Common Shareholder)</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.IncomeStatement.NetIncomeCommon / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.IncomeStatement.NetIncomeCommon / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.IncomeStatement.NetIncomeCommon / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.IncomeStatement.NetIncomeCommon / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.IncomeStatement.NetIncomeCommon / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Depreciation & Amortization</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.DepreciationAmortization / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.DepreciationAmortization / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.DepreciationAmortization / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.DepreciationAmortization / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.DepreciationAmortization / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Non Cash Items</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.NonCashItems / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.NonCashItems / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.NonCashItems / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.NonCashItems / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.NonCashItems / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Change in Working Capital</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.ChangeinWorkingCapital / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.ChangeinWorkingCapital / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.ChangeinWorkingCapital / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.ChangeinWorkingCapital / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.ChangeinWorkingCapital / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Operating Cashflow</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.NetCashfromOperatingActivities / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.NetCashfromOperatingActivities / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.NetCashfromOperatingActivities / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.NetCashfromOperatingActivities / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.NetCashfromOperatingActivities / 1000)</td>
        </tr>
        <tr style="text-align:right">
            <td style="text-align:left">Purchase of Fixed Assets (CAPEX)</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.PurchaseofFixedAssets / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.PurchaseofFixedAssets / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.PurchaseofFixedAssets / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.PurchaseofFixedAssets / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.PurchaseofFixedAssets / 1000)</td>
        </tr>
        <tr style="text-align: right; font-weight: bold">
            <td style="text-align:left">Free Cashflow / Owners Earnings</td>
            @if (Filing5 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing5.CashflowStatement.FreeCashFlow / 1000)</td>
            }
            @if (Filing4 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing4.CashflowStatement.FreeCashFlow / 1000)</td>
            }
            @if (Filing3 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing3.CashflowStatement.FreeCashFlow / 1000)</td>
            }
            @if (Filing2 != null)
            {
                <td>@string.Format("{0:#,##0}", Filing2.CashflowStatement.FreeCashFlow / 1000)</td>
            }
            <td>@string.Format("{0:#,##0}", Filing1.CashflowStatement.FreeCashFlow / 1000)</td>
        </tr>
    </table>
</div>